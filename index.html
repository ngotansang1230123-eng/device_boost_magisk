<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZArchiver Pro - Persistent</title>
    <style>
        :root { --bg: #121212; --surface: #1e1e1e; --primary: #4CAF50; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; user-select: none; }
        .header { background: var(--surface); padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); position: sticky; top: 0; z-index: 10; }
        .path-display { font-size: 12px; color: var(--primary); background: #000; padding: 10px; border-radius: 4px; word-break: break-all; margin-top: 10px; border: 1px solid #333; }
        .file-container { padding: 10px; min-height: 60vh; }
        .item { display: flex; align-items: center; padding: 12px; border-radius: 8px; margin-bottom: 5px; border: 1px solid transparent; }
        .item.selected { background: rgba(76, 175, 80, 0.2); border: 1px solid var(--primary); }
        .icon { font-size: 24px; margin-right: 15px; }
        .info { flex-grow: 1; }
        .size { font-size: 11px; color: #888; }
        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: var(--surface); display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #333; }
        .btn { display: flex; flex-direction: column; align-items: center; font-size: 12px; color: var(--text); cursor: pointer; border: none; background: none; transition: 0.3s; }
        .btn:disabled { opacity: 0.3; filter: grayscale(1); }
        .nav-buttons { display: flex; gap: 10px; }
        .nav-btn { background: #333; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 12px; flex: 1; }
        .nav-btn.active { background: var(--primary); }
    </style>
</head>
<body>

<div class="header">
    <div class="nav-buttons">
        <button id="btn-dl" class="nav-btn" onclick="goToPath('download')">Download</button>
        <button id="btn-game" class="nav-btn" onclick="goToPath('game')">Config Game</button>
    </div>
    <div class="path-display" id="pathText">/sdcard/Download/</div>
</div>

<div class="file-container" id="fileList"></div>

<div class="bottom-bar">
    <button class="btn" id="copyBtn" onclick="setOperation('copy')" disabled><span>üìã</span>Sao ch√©p</button>
    <button class="btn" id="cutBtn" onclick="setOperation('cut')" disabled><span>‚úÇÔ∏è</span>C·∫Øt</button>
    <button class="btn" id="pasteBtn" onclick="pasteFile()" disabled><span>üì•</span>D√°n t·∫°i ƒë√¢y</button>
    <button class="btn" onclick="resetApp()"><span>üîÑ</span>Reset</button>
</div>

<script>
    // 1. Kh·ªüi t·∫°o d·ªØ li·ªáu
    let currentDir = 'download'; 
    let selectedFile = null;
    let clipboard = null; 

    const paths = {
        download: "/sdcard/Download/",
        game: "/sdcard/iOS/data/com.dts.fefeth/files/contentcache/Compulsory/ios/gameassetbundles/config/"
    };

    // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh
    const defaultFiles = {
        download: [{ name: "lockbot.so", size: "13.42 MB" }, { name: "instruction.txt", size: "2 KB" }],
        game: []
    };

    let files = {};

    // 2. H√†m l∆∞u v√† t·∫£i d·ªØ li·ªáu t·ª´ tr√¨nh duy·ªát
    function saveData() {
        localStorage.setItem('zarchiver_files', JSON.stringify(files));
        localStorage.setItem('zarchiver_path', currentDir);
    }

    function loadData() {
        const saved = localStorage.getItem('zarchiver_files');
        const savedPath = localStorage.getItem('zarchiver_path');
        if (saved) {
            files = JSON.parse(saved);
        } else {
            files = JSON.parse(JSON.stringify(defaultFiles));
        }
        if (savedPath) currentDir = savedPath;
    }

    // 3. Hi·ªÉn th·ªã giao di·ªán
    function render() {
        const list = document.getElementById('fileList');
        const pathText = document.getElementById('pathText');
        list.innerHTML = "";
        pathText.innerText = paths[currentDir];

        // Highlight n√∫t ƒëi·ªÅu h∆∞·ªõng
        document.getElementById('btn-dl').className = `nav-btn ${currentDir === 'download' ? 'active' : ''}`;
        document.getElementById('btn-game').className = `nav-btn ${currentDir === 'game' ? 'active' : ''}`;

        files[currentDir].forEach(f => {
            const div = document.createElement('div');
            div.className = `item ${selectedFile === f.name ? 'selected' : ''}`;
            div.onclick = () => selectFile(f.name);
            div.innerHTML = `
                <span class="icon">${f.name.endsWith('.so') ? '‚öôÔ∏è' : 'üìÑ'}</span>
                <div class="info">
                    <div>${f.name}</div>
                    <div class="size">${f.size}</div>
                </div>`;
            list.appendChild(div);
        });

        document.getElementById('pasteBtn').disabled = !clipboard;
    }

    function selectFile(name) {
        selectedFile = (selectedFile === name) ? null : name;
        document.getElementById('copyBtn').disabled = !selectedFile;
        document.getElementById('cutBtn').disabled = !selectedFile;
        render();
    }

    function goToPath(dir) {
        currentDir = dir;
        selectedFile = null;
        saveData(); // L∆∞u l·∫°i v·ªã tr√≠ th∆∞ m·ª•c cu·ªëi c√πng
        render();
    }

    function setOperation(type) {
        clipboard = { 
            file: files[currentDir].find(f => f.name === selectedFile), 
            type: type, 
            from: currentDir 
        };
        alert(`ƒê√£ chu·∫©n b·ªã ƒë·ªÉ ${type === 'copy' ? 'sao ch√©p' : 'di chuy·ªÉn'}: ${selectedFile}`);
        render();
    }

    function pasteFile() {
        if (!clipboard) return;

        // Th√™m v√†o th∆∞ m·ª•c hi·ªán t·∫°i
        files[currentDir].push(clipboard.file);

        // N·∫øu l√† C·∫Øt th√¨ x√≥a ·ªü th∆∞ m·ª•c g·ªëc
        if (clipboard.type === 'cut') {
            files[clipboard.from] = files[clipboard.from].filter(f => f.name !== clipboard.file.name);
        }

        alert("D√°n th√†nh c√¥ng!");
        clipboard = null;
        saveData(); // Ghi nh·ªõ thay ƒë·ªïi v√†o b·ªô nh·ªõ tr√¨nh duy·ªát
        render();
    }

    function resetApp() {
        if(confirm("B·∫°n mu·ªën reset l·∫°i d·ªØ li·ªáu ban ƒë·∫ßu?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // Ch·∫°y ·ª©ng d·ª•ng
    loadData();
    render();
</script>
</body>
</html>
